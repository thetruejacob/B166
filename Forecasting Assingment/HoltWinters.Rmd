---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

Using Holt-Winters, or Triple-Exponential Smoothing 

```{r}
lapply(c("stats", "forecast", "MLmetrics"), require, character.only = TRUE)

df = read.table("Downloads/co2_mm_mlo.txt", col.names = c("Year", "Month", "Date", "average", "interpolated", "trend", "days"))
df$Dates = as.Date(paste(df$Year, df$Month, 1, sep = "-"), format = "%Y-%m-%d")
plot(df[,8], df[,5], type = "l", xlab = "Year", ylab = "Yearly Average", 
     main = "Mauna Loa Yearly Carbon Dioxide Concentration")
plot(1958:2018, tapply(df[,5], format(df[,8], "%Y"), mean), xlab = "Year", 
     ylab = "Yearly Average", main = "Mean Annual CO2 Levels", type = "l")
plot(df[647:718, 8], df[647:718, 4], type = "o", xlab = "Years", 
     ylab = "Average CO2 Level (ppm)", main = "Recent Monthly Mean CO2 Levels")
```

This is for a simple prediction on the training data
```{r}
shortts = ts(df[647:718, 4], frequency = 12, start = c(2012, 1))  # only 2012-2017
fullts = ts(df[1:718,5], frequency = 12, start = c(1958, 3))      # 1953 - 2017
plot(HoltWinters(shortts))
plot(HoltWinters(fullts))
MAPE(HoltWinters(shortts)$fitted[,1], df[659:718, 4])
MAPE(HoltWinters(fullts)$fitted[,1], df[13:718,5])
```

This is for a prediction of future seasonal data
```{r}
pred = data.frame(predict(stats::HoltWinters(fullts), n.ahead = 50, prediction.interval = 1))
pred$date = seq(as.Date("2018-01-01"), by = "month", length.out = nrow(pred))

plot(df[647:726,8], df[647:726, 4], type = "o", main = "Predicted CO2 (Holt-Winters)", 
     xlab = "Year", ylab = "CO2 (ppm)", 
     xlim = range(pred[,4], df[647:726,8]), ylim = range(pred[,2],df[647:726, 4] ))
matlines(pred[,4], pred[,-4], lwd = c(2,1,1), lty = c(1,2,2),)

MAPE(pred[1:8,1], df[719:726,5])
```


